<div class="container">

  <div class="row">
      <div class="col-md-6">
        <%= image_tag "logo.png", class: "img-responsive" %>
        <button type="button" class="btn btn-primary btn" data-toggle="modal" data-target="#mynewpost">
          Nueva ficha
        </button>
      </div>

      <div class="col-md-6">

        <table class="table">

          <h4 class="text-center">Resumen año 2015 de <%= current_user.name %></h4>
            <thead>
            <tr class="info">
              <td>Vacaciones</td>
              <td>Total año</td>
              <td>Disfrutadas</td>
              <td>Restan</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td>22</td>
              <td><%= Post.where(:alta => "2015-01-01".."2015-12-31", :user_id => current_user).sum(:vacaciones) %></td>
              <td><%= Post.sum(:vacaciones) %></td>
            </tr>
          </tbody>
          <thead>
            <tr class="info">
              <td>Bolsa Horas</td>
              <td>Acumuladas</td>
              <td>Disfrutadas</td>
              <td>Restan</td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td><%= Post.where(:alta => "2015-01-01".."2015-12-31", :user_id => current_user).sum(:bolsahg) %></td>
              <td><%= Post.where(:alta => "2015-01-01".."2015-12-31", :user_id => current_user).sum(:bolsahu) %></td>
              <td><%= Post.where(:alta => "2015-01-01".."2015-12-31", :user_id => current_user).sum(:bolsahg) - Post.where(:alta => "2015-01-01".."2015-12-31", :user_id => current_user).sum(:bolsahu) %></td>
            </tr>
          </tbody>
        </table>
      </div>
  </div>


  <div class="row">
    <div id ="posts">  
      <h3 id="month">
        <%= link_to "", {date: @date.prev_month}, class: "glyphicon glyphicon-chevron-left btn btn-primary btn-lg" %>
        <%= @date.strftime("%B %Y") %>
        <%=link_to "", {date: @date.next_month}, class: "glyphicon glyphicon-chevron-right btn btn-primary btn-lg" %>
      </h3>
      <%= calendar @date do |date| %>
      <%= date.day %>
      <% if @posts_by_date[date] %>
      <ul>
        <% @posts_by_date[date].each do |post| %>

        <li id="post_<%= post.id %>">
          <% if current_user.admin? %>
          <%= link_to post do %>
          <%= post.title %>-<%= post.user.name %><% end %>
          <% else %>
          <%= link_to post.title, post %>
          <% end %>

          <div  class="pull-right">
          <%= link_to '' , post, class: "glyphicon glyphicon-pencil", remote: :true, data: {toggle: "modal", target: "#myupdatepost_#{post.id}"} %>
          <%= link_to '' , post, method: :delete, class: "glyphicon glyphicon-remove-circle", remote: :true, data: {confirm: 'Are you sure?'} %>
          </div>

          <!-- Modal - update posts -->
          <%= form_for( post, :method => :put, remote: true) do |f| %> 
          <div class="modal fade" id="myupdatepost_<%= post.id %>" tabindex="-1" role="dialog" aria-labelledby="myModelLabel" aria-hidden="true" data-target="myupdatepost_<%= post.id %>">

            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  <h4 class="modal-title" id="myModalLabel">Edit</h4>
                </div>
                <div class="modal-body">

                  <%= f.text_area :title, class: "form-control", label: false, autofocus: true, placeholder: "Titulo", rows: 1 %><br>

                  <%= f.text_area :content, class: "form-control", label: false, placeholder: "Contenido", rows: 1 %><br>

                  <div class="input-group">
                    <%= f.date_field :alta, class: "form-control post_content datepicker", :data => {:provide => 'datepicker'}, label: false, placeholder: "Alta", rows: 1 %><span class="input-group-addon" id="basic-addon1" >
                    <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>
                  </span></div> <br>

                  <%= f.text_area :pedido, class: "form-control", label: false, placeholder: "Pedido", rows: 1 %><br>

                  <%= f.text_area :horasof, class: "form-control", label: false, placeholder: "Horas ordinarias facturadas", rows: 1 %><br>

                  <%= f.text_area :horasnf, class: "form-control", label: false, placeholder: "Horas no facturadas", rows: 1 %><br>

                  <%= f.text_area :extra, class: "form-control", label: false, placeholder: "Extra", rows: 1 %><br>

                  <%= f.text_area :extraf, class: "form-control", label: false, placeholder: "Extra facturadas", rows: 1 %><br>

                  <%= f.text_area :nocturnas, class: "form-control", label: false, placeholder: "Nocturnas", rows: 1 %><br>

                  <%= f.text_area :vacaciones, class: "form-control", label: false, placeholder: "Vacaciones", rows: 1 %><br>

                  <%= f.text_area :bolsahg, class: "form-control", label: false, placeholder: "Bolsa de horas generadas", rows: 1 %><br>

                  <%= f.text_area :bolsahu, class: "form-control", label: false, placeholder: "Bolsa de horas utilizadas", rows: 1 %><br>
                </div>
                <div class="modal-footer">
                  <button type="button" id="myupdatebutton" class="btn btn-default" data-dismiss="modal">Close</button>
                  <%= submit_tag "Update", class: "btn btn-primary" %>
                </div>
              </div>
            </div>
          </div>
          <% end %>
          <!-- Modal -->


        </li>
      </div>
        <% end %>
      </ul>
      <% end %>
      <% end %>



    <p><%= link_to "New Post", new_post_path %></p>
    <!--  Modal create action -->
    <%= form_for(@post, remote: true) do |f| %>
    <div class="modal fade" id="mynewpost" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog">
        <div class="modal-content">

          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Post</h4>
          </div>
          <div class="modal-body">

            <%= f.text_area :title, class: "form-control post_title", label: false, autofocus: true, placeholder: "Titulo", rows: 1 %><br>

            <%= f.text_area :content, class: "form-control post_content", label: false, placeholder: "Contenido", rows: 1 %><br>
            <div class="input-group">

              <%= f.datetime_field :alta, class: "form-control post_content datepicker", :data => {:provide => 'datepicker'}, label: false, placeholder: "Alta", rows: 1 %><span class="input-group-addon" id="basic-addon1" >
              <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>
            </span></div> <br>

            <%= f.text_area :pedido, class: "form-control post_content", label: false, placeholder: "Pedido", rows: 1 %><br>

            <%= f.text_area :horasof, class: "form-control post_content", label: false, placeholder: "Horas ordinarias facturadas", rows: 1 %><br>

            <%= f.text_area :horasnf, class: "form-control post_content", label: false, placeholder: "Horas no facturadas", rows: 1 %><br>

            <%= f.text_area :extra, class: "form-control post_content", label: false, placeholder: "Extra", rows: 1 %><br>

            <%= f.text_area :extraf, class: "form-control post_content", label: false, placeholder: "Extra facturadas", rows: 1 %><br>

            <%= f.text_area :nocturnas, class: "form-control post_content", label: false, placeholder: "Nocturnas", rows: 1 %><br>

            <%= f.text_area :vacaciones, class: "form-control post_content", label: false, placeholder: "Vacaciones", rows: 1 %><br>

            <%= f.text_area :bolsahg, class: "form-control post_content", label: false, placeholder: "Bolsa de horas generadas", rows: 1 %><br>

            <%= f.text_area :bolsahu, class: "form-control post_content", label: false, placeholder: "Bolsa de horas utilizadas", rows: 1 %><br>

          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal" id="mynewpostclose">Close</button>
            <%= submit_tag "Create", class: "btn btn-primary" %>
          </div>
        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>

    

